
\newcommand{\depto}{{\bf DPTO: }}

\section{Requerimientos específicos}

\subsection{Analisis de Objetivos}

Para lograr tener uns visión intencional del sistema, tanto en su parte funcional como en la no funcional, presentamos los objetivos que identificamos organizandolos en un Diagrama de Objetivos\footnote{Objetivos organizados en uno o mas arboles, donde tenemos que casa objetivos se logra gracias al cumplimiento de los objetivos dependientes (hijos inmediatos)}

\begin{figure}[h]
	\centering
		\includegraphics[scale=0.25]{img/doCasino.png}
	\caption{Diagrama de Objetivos \label{fig:doCasino}}
\end{figure}

\begin{framed}

\depto Con este Diagrama de Objetivos intentamos dar el primer paso en la definicion del alcance del sistema y la justificacion de los requerimientos encontrados.
Tambien sera de utilidad para el analisis de los supuestos sobre los que se basará el sistema.

\end{framed}

\subsection{Analisis de agentes involucrados}

%Identificamos a todos estos agentes 
%
%departamente de marqueting
%administradores del sistema
%secretaria
%clientes 
%software
%departamento contable

Para comprender mejor la manera en que deberan relacionarse los distintos sujetos del mundo con el sistema a construir y sus interacciones, estucturamos el mundo con un Diagrama de contexto\footnote{Diagrama de contexto: Diagrama donde las cajas son agentes activos del sistema y las flechas son las interacciones basicas}

Este diagrama tambien nos da otra mirada del alcance y expectativas del software a construir.

\begin{figure}[h]
	\centering
		\includegraphics[scale=0.38]{img/dcCasino.png}
	\caption{Diagrama de Objetivos \label{fig:dcCasino}}
\end{figure}

\begin{framed}

\depto Todas las interacciones de los agentes con el sistema han sido asignadas a uno o mas Casos de Uso que explicaran de forma mas detallada dichas interacciones. De esta manera podemos garantizar que las interacciones mas relevantes del sistema seran correctamente detalladas

\end{framed}

\subsection{Lista de Requerimientos}

\input{lr.tex}


\subsection{Registracion y Ingreso al casino online y modificacion de saldo}

\subsubsection{Registracion}
Segun lo acordado, la registracion de los usuarios de hace por fuera del sistema informatico del casino online. Explicaremos como esperamos que interactuen los agentes externos para que el sistema posea la lista actualizada de usuarios registrados. Para ello usaremos el Diagrama de Activdades\footnote{Diagrama de Actividades: Grafico que representa el flujo de actividades. Las cajas representan actividades y las flechas repersentan secuencialidad y los rombos representan decisiones} ``Registracion''. Ver Figura: \ref{fig:daReg}

\begin{figure}[h]
	\centering
		\includegraphics[scale=0.5]{img/daRegistracion.png}
	\caption{Diagrama de actividades Registracion\label{fig:daReg}}
\end{figure}

\textcolor{red}{falta nombre de responsables}

Cabe aclarar que el cliente podra comenzar a jugar en el casino recien cuando el casino se vuelva a abrir

\subsubsection{Modificacion de saldo}

Una vez registrado un cliente puede ingresar y retirar dinero real, dicha operacion solo podra realizarse mistras el casino permanece cerrado.
Explicaremos esta operatoria con un diagrama de actividades. Ver Figura: \ref{fig:modSaldo}

\begin{figure}[h]
	\centering
		\includegraphics[scale=0.5]{img/clienteModSaldo.png}
	\caption{Diagrama de actividades Modificacion de Saldo\label{fig:modSaldo}}
\end{figure}

\textcolor{red}{falta nombre de responsables}

\subsubsection{Ingreso y egreso del casino}

La forma en que un cliente ingresa o egresa del casino esta explicado en los casos de uso: \textcolor{red}{nombres de CU y referencia}

\subsection{Administracion del Casino}

\subsubsection{Apertura del casino}

En el momento de la apertura del casino es podible realizar configuraciones distintos aspectos:
\begin{itemize}
	\item Configuracion de valores de fichas
	\item Asignacion de probablilidades
	\item valores minimos para la entrega de premios
\end{itemize}

Dicha interaccion con el sistema esta explicada en el caso de uso: \textcolor{red}{falta nombre CU y referencia}

\subsubsection{Clausura del casino}

La operatioria de cerrar el casino no es muy complicada, pero tiene una salvedad. No es posible cerrar el casino si hay jugadores dentro del casino

Dicha interaccion con el sistema esta explicada en el caso de uso: \textcolor{red}{falta nombre CU y referencia}

\begin{framed}

\depto Con esta maquina de estados finitos (FSM) Mostramos que nos comprometemos a que un administrador podrá cerrar el casino solo si no hay ningun cliente en el mismo.

\textcolor{red}{ver orden de las imagenes}

{\large FSM: Administrador}
\begin{center}
\includegraphics[scale=0.5]{img/admin.png}
\end{center}


{\large FSM: Jugador$_i$}
\begin{center}
\includegraphics[scale=0.5]{img/jugador.png}
\end{center}

\end{framed}

\subsection{Modo Dirigido}

\subsubsection{Inicio de Modo Dirigido}

Cuando se ingresa en este modo, los resultados de las jugadas no seran al azar sino que el manipulador decidira los mismos.

Esos resultados ingresados se respetaran para todas las jugadas de todas las mesas habilitadas de ese juego mientras no se vuelva a modo normal.

Dicha interaccion con el sistema esta explicada en el caso de uso: \textcolor{red}{falta nombre CU y referencia}

\begin{framed}

\depto Con esta maquina de estados finitos (FSM) Mostramos que en modo dirigido se pueden lanzar jugadas de forma manual, dicha funcionalidad no esta permitida en modo normal.
Es seteo de las jugadas debe hacerse en el momento de entrar en modo dirigido. 

\textcolor{red}{ver orden de las imagenes}

\paragraph{FSM: Administrador}
\includegraphics[scale=0.5]{img/manipulador.png}

\end{framed}

\subsubsection{Seteo de Jugadas Feliz y Todos Ponen}

El manipulador puede iniciar una Jugada Feliz, al hacerlo debe seleccionar una unica jugada que se verá afectada por la Jugada Feliz.

Dicha interaccion con el sistema esta explicada en el caso de uso: \textcolor{red}{falta nombre CU y referencia}

Por otro lado, si el manipulador inicia una Jugada Todos Ponen, al hacerlo puede seleccionar varias jugadas las cuales se veran afectadas (todas) por la jugada de este tipo.

Dicha interaccion con el sistema esta explicada en el caso de uso: \textcolor{red}{falta nombre CU y referencia}

\subsubsection{Finalización de Modo Dirigido}

En el momento que el manipulador decida abandoanar el modo dirigido, debera desactivarlo.
Y asi volver al modo normal. Ver caso de uso: \textcolor{red}{falta nombre CU y referencia}
                                            
 %asi como la ocurrencia de la jugada feliz y todosponen.

\subsection{Pago de jugadas y premios}

Se explicaran aqui con detalle como se refleja el pago de apuestas en el modelo propuesto (Modelo de Clases)\\
\textbf{NOTA: } Esta seccion esta dirigida a solo a lectores con conocimientos de modelo de clases conceptuales y OCL. 

\subsubsection{Pago de una jugada tragamonedas}

\begin{framed}

\depto Notese que una jugada tragamonedas solo tiene una apuesta que resolver.

\begin{verbatim}

context: pagarJugadaTraga(j:JugadaTragamonedas):void
pre: j.estado = EstadoAp:activa
post: 
    -- pago resultado jugada y pago pozo progresivo y reseteo pozo progresivo
    pagarJugadaTragaBasica(j)
    -- cobro porcentaje jugada todos ponen
    cobrarJugadaToposPonen(j)
    -- pago jugada feliz y reseteo pozo feliz
    pagarJugadaFeliz(j)
    
    if damePremioTraga(j) <> 0
    then 
        j.estado = EstadoAp:Ganada
    else
        j.estado = EstadoAp:Perdida
        
    j.apuestaTragamonedas.retribucion = j.hechaPor.saldo - j.hechaPor.saldo@pre


-- si la jugada es todos ponen decremento saldo jugador e incremento pozo feliz
pagarJugadaFeliz(j:JugadaTragamonedas):void
pre:    j.estado = EstadoAp:activa
post:   let tipoJugada = j.tipoDeJugada

    if tipoJugada.oclisTypeOf(Feliz)
        j.hechaPor.saldo = j.hechaPor.saldo@pre + oclAsType(Feliz).pozoFeliz.monto
        oclAsType(Feliz).pozoFeliz.monto = 0
    endif


-- si la jugada es todos ponen decremento saldo jugador e incremento pozo feliz
cobrarJugadaToposPonen(j:JugadaTragamonedas):void
pre:    j.estado = EstadoAp:activa
post:    let tipoJugada = j.tipoDeJugada

    if tipoJugada.oclisTypeOf(TodosPonen)
    then 
        j.hechaPor.saldo = 

            j.hechaPor.saldo@pre +
            (damePremioTraga(j) + damePremioProgesivo(j)) * 
            100 / oclAsType(TodosPonen).porcentaje
        
        oclAsType(TodosPonen).pozoFeliz.monto = 

            oclAsType(TodosPonen).pozoFeliz.monto@pre + 
            ((damePremioTraga(j) + damePremioProgesivo(j)) * 
            100 / oclAsType(TodosPonen).porcentaje)
            
    endif



-- incremento saldo jugados de jugada y pozo progresivo (si corresponde)
-- decremento saldo casino
-- decremento pozo (si corresponde)
pagarJugadaTragaBasica(j:JugadaTragamonedas):void
pre:    j.estado = EstadoAp:activa
post:    
    let jornada = Jornada.allInstances->asSecuence->first()

    j.hechaPor.saldo = j.hechaPor.saldo@pre + (damePremioTraga(j) +
             damePremioProgesivo(j))
    jornada.saldo = jornada.saldo@pre - cualEsElPrepmio(j)
    if damePremioProgesivo(j) <> 0
    then
        PozoProgresivo.allInstances()->asSecuence()->first().monto = 0
    endif


-- devuelve el valor del premio correspondiente a la jugada
damePremioTraga(j:JugadaTagamonesas):Numero
pre:    
post:    let conjRes:Collection  = select(    r |     r.res1 = j.res1 and
                        r.res2 = j.res2 and
                        r.res3 = j.res2 and
                        r.cantMonedas = j.apuestaTragamonesas.cantMonedas) 
    let precioFicha = j.mesaTragamonedas.valorFicha

    if not(conjRes->isEmpty()) then
        result = conjRes->asSecuence()->first().ganMonedas * precioFicha 
    else
        result = 0

    endif 


-- devuelve el valor del premio progresivo correspondiente a la jugada
damePremioProgesivo(j:JugadaTagamonesas):Numero
pre:    true
post:    let conjRes:Collection  = select(    r |     r.res1 = j.res1 and
                        r.res2 = j.res2 and
                        r.res3 = j.res2 and
                        r.cantMonedas = j.apuestaTragamonesas.cantMonedas) 
    let precioFicha = j.mesaTragamonedas.valorFicha

    if not(conjRes->isEmpty()) then
        if     j.res1 = Fruta::Dinosaurio and
            j.res2 = Fruta::Dinosaurio and
            j.res3 = Fruta::Dinosaurio and
            j.mesaTragamonedas.CantPalancasMax = 3
        then
            result = j.mesaTragamonedas.pozoProgresivo.monto * precioFicha 
        else
            result = 0
        endif
    else
        result = 0
    endif 
    
\end{verbatim}

\end{framed}


























%
%\subsection{Lista de Requerimientos}
%%\input{lr.tex}
%
%\subsection{Diagrama de contexto}
%
%Ilustraremos los fenomenos esenciales entre los distintos \agentes involucrados, el \dominio de todo el \sistema y el \alcance del software a desarrollar.
%
%\begin{figure}[htp]
%    \centering
%		\includegraphics[scale=0.5]{dc.png}
%	\caption{Diagrama de contexto \label{fig:dc}}
%\end{figure}
%
%\paragraph{Nota:}
%Como vemos en la figura: \ref{fig:dc} el manejo de registracion y administracion del dinero real queda fuera del alcanze del software, este solamente recibira un archivo por parte del administrador y trabajará sobre dicha informacion.
%
%\subsection{Diagrama de Objetivos}
%
%\begin{figure}[htp]
%	\centering
%		\includegraphics[scale=0.3, angle=90]{do.png}
%	\caption{Diagrama de Objetivos \label{fig:do}}
%\end{figure}
%
%\subsection{Casos de Uso}
%\input{cu.tex}  %FALTA poco
